---
import Layout from "./Layout.astro";
const { title, mp3 } = Astro.props;
---

<Layout>
	<slot name="headScripts">
		<script
			defer
			src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
		></script>
		<script type="module">
			import AudioMotionAnalyzer from "https://cdn.skypack.dev/audiomotion-analyzer?min";

			// audio source
			const audioEl = document.getElementById("audio");

			const gradients = {
				apple: {
					name: "Apple ][",
					colorStops: [
						{ pos: 0.1667, color: "#61bb46" },
						{ pos: 0.3333, color: "#fdb827" },
						{ pos: 0.5, color: "#f5821f" },
						{ pos: 0.6667, color: "#e03a3e" },
						{ pos: 0.8333, color: "#963d97" },
						{ pos: 1, color: "#009ddc" },
					],
					disabled: false,
				},
				aurora: {
					name: "Aurora",
					bgColor: "#0e172a",
					colorStops: [
						{ pos: 0.1, color: "hsl( 120, 100%, 50% )" },
						{ pos: 1, color: "hsl( 216, 100%, 50% )" },
					],
					disabled: false,
				},
				borealis: {
					name: "Borealis",
					bgColor: "#0d1526",
					colorStops: [
						{ pos: 0.1, color: "hsl( 120, 100%, 50% )" },
						{ pos: 0.5, color: "hsl( 189, 100%, 40% )" },
						{ pos: 1, color: "hsl( 290, 60%, 40% )" },
					],
					disabled: false,
				},
				candy: {
					name: "Candy",
					bgColor: "#0d0619",
					colorStops: [
						{ pos: 0.1, color: "#ffaf7b" },
						{ pos: 0.5, color: "#d76d77" },
						{ pos: 1, color: "#3a1c71" },
					],
					disabled: false,
				},
				classic: { name: "Classic", disabled: false },
				cool: {
					name: "Cool",
					bgColor: "#0b202b",
					colorStops: [
						"hsl( 208, 0%, 100% )",
						"hsl( 208, 100%, 35% )",
					],
					disabled: false,
				},
				dusk: {
					name: "Dusk",
					bgColor: "#0e172a",
					colorStops: [
						{ pos: 0.2, color: "hsl( 55, 100%, 50% )" },
						{ pos: 1, color: "hsl( 16, 100%, 50% )" },
					],
					disabled: false,
				},
				miami: {
					name: "Miami",
					bgColor: "#110a11",
					colorStops: [
						{ pos: 0.024, color: "rgb( 251, 198, 6 )" },
						{ pos: 0.283, color: "rgb( 224, 82, 95 )" },
						{ pos: 0.462, color: "rgb( 194, 78, 154 )" },
						{ pos: 0.794, color: "rgb( 32, 173, 190 )" },
						{ pos: 1, color: "rgb( 22, 158, 95 )" },
					],
					disabled: false,
				},
				orient: {
					name: "Orient",
					bgColor: "#100",
					colorStops: [
						{ pos: 0.1, color: "#f00" },
						{ pos: 1, color: "#600" },
					],
					disabled: false,
				},
				outrun: {
					name: "Outrun",
					bgColor: "#101",
					colorStops: [
						{ pos: 0, color: "rgb( 255, 223, 67 )" },
						{ pos: 0.182, color: "rgb( 250, 84, 118 )" },
						{ pos: 0.364, color: "rgb( 198, 59, 243 )" },
						{ pos: 0.525, color: "rgb( 133, 80, 255 )" },
						{ pos: 0.688, color: "rgb( 74, 104, 247 )" },
						{ pos: 1, color: "rgb( 35, 210, 255 )" },
					],
					disabled: false,
				},
				pacific: {
					name: "Pacific Dream",
					bgColor: "#051319",
					colorStops: [
						{ pos: 0.1, color: "#34e89e" },
						{ pos: 1, color: "#0f3443" },
					],
					disabled: false,
				},
				prism: { name: "Prism", disabled: false },
				rainbow: { name: "Rainbow", disabled: false },
				shahabi: {
					name: "Shahabi",
					bgColor: "#060613",
					colorStops: [
						{ pos: 0.1, color: "#66ff00" },
						{ pos: 1, color: "#a80077" },
					],
					disabled: false,
				},
				summer: {
					name: "Summer",
					bgColor: "#041919",
					colorStops: [
						{ pos: 0.1, color: "#fdbb2d" },
						{ pos: 1, color: "#22c1c3" },
					],
					disabled: false,
				},
				sunset: {
					name: "Sunset",
					bgColor: "#021119",
					colorStops: [
						{ pos: 0.1, color: "#f56217" },
						{ pos: 1, color: "#0b486b" },
					],
					disabled: false,
				},
				tiedye: {
					name: "Tie Dye",
					colorStops: [
						{ pos: 0.038, color: "rgb( 15, 209, 165 )" },
						{ pos: 0.208, color: "rgb( 15, 157, 209 )" },
						{ pos: 0.519, color: "rgb( 133, 13, 230 )" },
						{ pos: 0.731, color: "rgb( 230, 13, 202 )" },
						{ pos: 0.941, color: "rgb( 242, 180, 107 )" },
					],
					disabled: false,
				},
			};

			// instantiate analyzer
			const audioMotion = new AudioMotionAnalyzer(
				document.getElementById("audio-motion-container"),
				{
					source: audioEl,
					height: window.innerHeight,
					showScaleX: false,
					// you can set other options below - check the docs!
					//gradient: "Tie Dye",
					//mode: 3,
					//barSpace: 0.6,
					//ledBars: true,
				}
			);

			audioMotion.registerGradient("Tie Dye", {
				colorStops: [
					{ pos: 0.038, color: "rgb( 15, 209, 165 )" },
					{ pos: 0.208, color: "rgb( 15, 157, 209 )" },
					{ pos: 0.519, color: "rgb( 133, 13, 230 )" },
					{ pos: 0.731, color: "rgb( 230, 13, 202 )" },
					{ pos: 0.941, color: "rgb( 242, 180, 107 )" },
				],
			});

			audioMotion.gradient = "Tie Dye";
		</script>
	</slot>

	<a href="/" class="bg-white/50 block fixed top-10 left-10 rounded-full p-2"
		><svg
			xmlns="http://www.w3.org/2000/svg"
			viewBox="0 0 24 24"
			fill="currentColor"
			class="w-6 h-6"
		>
			<path
				fill-rule="evenodd"
				d="M11.03 3.97a.75.75 0 0 1 0 1.06l-6.22 6.22H21a.75.75 0 0 1 0 1.5H4.81l6.22 6.22a.75.75 0 1 1-1.06 1.06l-7.5-7.5a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 0 1 1.06 0Z"
				clip-rule="evenodd"></path>
		</svg>
	</a>

	<main
		x-data="{ play: false }"
		class="grid grid-cols-1 grid-rows-1 place-items-center"
	>
		<div class="min-h-screen col-[1] row-[1] overflow-hidden">
			<div id="audio-motion-container"></div>
		</div>

		<div class="col-[1] row-[1]">
			<h1 class="text-center text-6xl font-black my-10 text-white">
				{title}
			</h1>

			<div>
				<button
					@click="play = !play; $refs.audio.paused ? $refs.audio.play() : $refs.audio.pause()"
					class="mx-auto rounded-full flex items-center justify-center w-20 h-20 bg-white"
				>
					<svg
						xmlns="http://www.w3.org/2000/svg"
						viewBox="0 0 24 24"
						fill="currentColor"
						class="w-12 h-12 transform translate-x-1"
						x-show="!play"
					>
						<path
							fill-rule="evenodd"
							d="M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z"
							clip-rule="evenodd"></path>
					</svg>
					<svg
						xmlns="http://www.w3.org/2000/svg"
						viewBox="0 0 24 24"
						fill="currentColor"
						class="w-12 h-12"
						x-show="play"
					>
						<path
							fill-rule="evenodd"
							d="M6.75 5.25a.75.75 0 0 1 .75-.75H9a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H7.5a.75.75 0 0 1-.75-.75V5.25Zm7.5 0A.75.75 0 0 1 15 4.5h1.5a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H15a.75.75 0 0 1-.75-.75V5.25Z"
							clip-rule="evenodd"></path>
					</svg>
				</button>
			</div>

			<div class="hidden">
				<audio id="audio" class="mx-auto" controls loop x-ref="audio">
					<source src={mp3} type="audio/mpeg" />
					Your browser does not support the audio element.
				</audio>
			</div>
		</div>
	</main>
	<slot />
</Layout>
